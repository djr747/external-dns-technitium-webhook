# External DNS Helm Chart Values for Integration Testing
# Deploys External DNS with webhook provider to sync DNS records to Technitium

# External DNS provider configuration
provider:
  name: webhook
  
  # Webhook provider sidecar container configuration
  webhook:
    # Image for the webhook provider (our Technitium webhook)
    image:
      repository: external-dns-technitium-webhook
      tag: latest
      pullPolicy: IfNotPresent
    
    # Environment variables for the webhook container
    env:
      # Technitium configuration - will be injected from secrets
      - name: TECHNITIUM_URL
        valueFrom:
          secretKeyRef:
            name: technitium-secret
            key: url
      - name: TECHNITIUM_USERNAME
        valueFrom:
          secretKeyRef:
            name: technitium-secret
            key: username
      - name: TECHNITIUM_PASSWORD
        valueFrom:
          secretKeyRef:
            name: technitium-secret
            key: password
      - name: ZONE
        valueFrom:
          secretKeyRef:
            name: technitium-secret
            key: zone
      - name: DOMAIN_FILTERS
        value: "test.local"
      - name: LOG_LEVEL
        value: "DEBUG"
    
    # Resources for the webhook container
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
    
    # Readiness probe for the webhook
    readinessProbe:
      httpGet:
        path: /health
        port: http-webhook
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 3
      failureThreshold: 6
    
    # Liveness probe for the webhook
    livenessProbe:
      httpGet:
        path: /health
        port: http-webhook
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 2
    
    # Service port configuration for the webhook
    service:
      port: 8080

# ClusterRoleBinding configuration
rbac:
  create: true
  
# Service Account
serviceAccount:
  create: true
  name: external-dns

# RBAC policies for External DNS
policy: sync

# Registry source configuration (what resources to read from)
sources:
  - ingress
  - service

# Domain filtering
domainFilters:
  - test.local

# Registry type for storing state
registry: txt

# TXT record prefix for registry
txtOwnerId: external-dns-test

# Replicas for testing
replicas: 1

# Pod resources for testing (minimal)
resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 200m
    memory: 256Mi

# Liveness probe for external-dns container
livenessProbe:
  httpGet:
    path: /metrics
    port: "7979"
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5

# Readiness probe for external-dns container
readinessProbe:
  httpGet:
    path: /metrics
    port: "7979"
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5

# Labels for pod selection
podLabels:
  app: external-dns
  test: integration

# Annotations for monitoring
podAnnotations:
  description: "External DNS with Technitium webhook for integration testing"

# SecurityContext for pod
securityContext:
  runAsNonRoot: true
  runAsUser: 65534
  fsReadOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL
