# External DNS Helm Chart Values for Integration Testing
# Deploys External DNS with webhook provider to sync DNS records to Technitium

# External DNS provider configuration
provider:
  name: webhook
  
  # Webhook provider sidecar container configuration
  webhook:
    # Image for the webhook provider (our Technitium webhook)
    image:
      imagePullPolicy: Never
    
    # Environment variables for the webhook container
    env:
      # Technitium configuration
      - name: TECHNITIUM_URL
        value: "http://technitium.default.svc.cluster.local:5380"
      - name: TECHNITIUM_USERNAME
        valueFrom:
          secretKeyRef:
            name: technitium-secret
            key: username
      - name: TECHNITIUM_PASSWORD
        valueFrom:
          secretKeyRef:
            name: technitium-secret
            key: password
      - name: ZONE
        value: "test.local"
      - name: CATALOG_ZONE
        value: "catalog.invalid"
      - name: DOMAIN_FILTERS
        value: "test.local"
      - name: LOG_LEVEL
        value: "DEBUG"
    
    # Resources for the webhook container
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
    
    # Service port configuration for the webhook
    service:
      port: 8080
    
    # SecurityContext for pod
    securityContext:
      runAsNonRoot: true
      runAsUser: 65532
      fsReadOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL

# RBAC policies for External DNS
policy: sync

# Sync interval for faster integration testing feedback
interval: 15s

# Registry source configuration (what resources to read from)
sources:
  - ingress
  - service

# Process ClusterIP services and internal IPs
publishInternalServices: true

# Domain filtering
domainFilters:
  - test.local

# Registry type for storing state
registry: txt

# TXT record prefix for registry
txtOwnerId: external-dns-test

# Replicas for testing
replicas: 1

# Pod resources for testing (minimal)
resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 200m
    memory: 256Mi

# Labels for pod selection
podLabels:
  app: external-dns
  test: integration

# Annotations for monitoring
podAnnotations:
  description: "External DNS with Technitium webhook for integration testing"

# Log level and format
logLevel: debug
logFormat: json