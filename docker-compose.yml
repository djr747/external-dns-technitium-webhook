version: '3.8'

services:
  technitium-dns:
    image: technitium/dns-server:latest
    container_name: technitium-dns
    hostname: dns-server
    security_opt:
      - no-new-privileges:true
    read_only: true
    ports:
      - "5380:5380/tcp"  # Web UI
      - "53:53/udp"      # DNS
      - "53:53/tcp"      # DNS
    environment:
      - DNS_SERVER_DOMAIN=dns-server
    volumes:
      - technitium_data:/etc/dns
    networks:
      - dns-network
    restart: unless-stopped

  webhook:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: external-dns-webhook
    ports:
      - "8888:8888"
    environment:
      - TECHNITIUM_URL=http://technitium-dns:5380
      - TECHNITIUM_USERNAME=admin
      - TECHNITIUM_PASSWORD=admin
      - ZONE=example.com
      - LOG_LEVEL=DEBUG
      - LISTEN_ADDRESS=0.0.0.0
    depends_on:
      - technitium-dns
    networks:
      - dns-network
    restart: unless-stopped

volumes:
  technitium_data:

networks:
  dns-network:
    driver: bridge
